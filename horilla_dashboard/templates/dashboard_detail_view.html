{% extends "index.html" %} {% load static %} {% load horilla_tags %}
{% load i18n %} {% load dashboard_tags %} {% block content %}
<div class="flex modelcontent">
    {% include "components/sub_sidebar.html" %}
    <div id="messages-container" style="display: none">
        {% for message in messages %}
            <div class="message" data-level="{{ message.tags }}" data-message="{{ message }}"></div>
        {% endfor %}
    </div>
    <div id="mainContent"
        class="flex-[1_0] leftspace transition-all duration-300 ease-in-out pt-0 overflow-hidden overflow-y-auto h-[100vh]">
        <div class="bg-white px-5 border-b border-b-dark-50 fixed w-fill-available z-30">
            <div class="flex flex-wrap items-center gap-2 justify-between">
                <div class="flex items-start">
                    <button class=""
                    hx-get="{{ previous_url }}"
                    hx-target="#mainContent"
                    hx-select-oob="#sideMenuContainer"
                    hx-swap="outerHTML"
                    hx-select="#mainContent"
                    hx-push-url="true" >
                    <i class="fas fa-arrow-left mr-2"></i>
                </button>
                    <div>
                        <h3 class="text-md font-semibold">{{ dashboard.name }}</h3>
                    </div>
                </div>
                <div class="flex items-center gap-5 h-[70px]">
                    <div class="flex items-center gap-5">
                        <div class="flex items-center gap-3">
                            <button
                                hx-get="{% url 'horilla_dashboard:component_create' %}?{{ request.GET.urlencode}}&dashboard={{current_obj.pk}}"
                                onclick="openModal()" hx-target="#modalBox" hx-swap="innerHTML"
                                class="border border-primary-500 btn-with-icon flex items-center gap-3 text-sm px-4 py-2 rounded-md text-[#E54F38] bg-[#ffefed] hover:bg-[#e54f38] hover:text-[white] transition duration-300 cursor-pointer">
                                <i class="fa-solid fa-plus"></i>
                                {% trans "Add components" %}
                            </button>
                            {% if has_components %}
                                <button onclick="openReorderModal()"
                                    class="text-sm px-4 py-2 bg-primary-600 rounded-md hover:bg-primary-800 transition duration-300 text-[white]">
                                    {% trans "Reorder" %}
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-5 pt-24" id="dashboard-detail-view">
            {% if has_components %}
                <!-- KPI Components - Always at the top -->
                {% with kpi_components=components|filter_by_type:'kpi' %}
                    {% if kpi_components %}
                        <div class="mb-6">
                            <div class="grid grid-cols-12 gap-6">
                                {% for component in kpi_components %}
                                <div class="col-span-3 kpi-component-fixed">
                                    <div hx-get="{% url 'horilla_dashboard:component_chart' component_id=component.id %}" hx-trigger="load"
                                        hx-swap="innerHTML" class="w-full h-full">
                                        <div class="text-gray-500 text-sm flex items-center justify-center h-full">
                                            {% trans "Loading KPI..." %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Other Components - Charts and Tables (Reorderable) -->
                {% with non_kpi_components=components|filter_by_type_exclude:'kpi' %}
                    {% if non_kpi_components %}
                        <div>
                            {% if kpi_components %}
                                <h4 class="text-lg font-medium mb-4 text-gray-700">
                                    {% trans "Charts & Data" %}
                                </h4>
                            {% endif %}
                            <div class="grid grid-cols-12 gap-6" id="reorderable-components">
                                {% for component in non_kpi_components %}
                                    <div class="col-span-6" data-component-id="{{ component.id }}">
                                        <div class="shadow-sm bg-white rounded-lg z-0 p-4 overflow overflow-hidden">
                                            <div class="flex items-center justify-between mb-3">
                                                <h3 class="text-md font-semibold">{{ component.name }}</h3>
                                                <div class="relative dropdown-wrapper">
                                                    <button id="dropdownbtn-{{ component.id }}" type="button"
                                                        class="flex relative z-[0]">
                                                        <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                                    </button>
                                                    <div
                                                        class="dropdown-content absolute bg-white rounded-lg shadow-lg min-w-[150px] py-2 right-0 border border-gray-200 z-[9]">
                                                        <ul class="text-sm py-1" aria-labelledby="dropdownbtn-{{ component.id }}">
                                                            <!-- Export options - only for chart components -->
                                                            {% if component.component_type == 'chart' %}
                                                            <li>
                                                                <a href="#"
                                                                    class="px-4 py-1.5 hover:text-primary-600 hover:bg-gray-50 transition duration-300 text-sm gap-4 items-center flex w-full"
                                                                    onclick="exportChart('component-chart-{{ component.id }}', '{{ component.name }}', 'png')">
                                                                    {% trans "Export as PNG" %}
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href="#"
                                                                    class="px-4 py-1.5 hover:text-primary-600 hover:bg-gray-50 transition duration-300 text-sm gap-4 items-center flex w-full"
                                                                    onclick="exportChart('component-chart-{{ component.id }}', '{{ component.name }}', 'pdf')">
                                                                    {% trans "Export as PDF" %}
                                                                </a>
                                                            </li>
                                                            {% endif %}

                                                            <!-- Edit/Update option - for chart and table components -->
                                                            {% has_perm "horilla_dashboard.change_dashboard" as can_change_dashboard %}
                                                            {% if can_change_dashboard or request.user.is_superuser or instance.dashboard_owner == request.user %}
                                                                {% if component.component_type == 'chart' or component.component_type == 'table_data' %}
                                                                    {% if not component.reports %}
                                                                        <li>
                                                                            <a href="#"
                                                                                class="px-4 py-1.5 hover:text-primary-600 hover:bg-gray-50 transition duration-300 text-sm gap-4 items-center flex w-full"
                                                                                hx-get="{% url 'horilla_dashboard:component_update' pk=component.id %}?{{ request.GET.urlencode}}"
                                                                                onclick="openModal()" hx-target="#modalBox" hx-swap="innerHTML">
                                                                                {% trans "Update" %}
                                                                            </a>
                                                                        </li>
                                                                    {% endif %}
                                                                {% endif %}
                                                                <li>
                                                                    <a href="#"
                                                                        class="px-4 py-1.5 hover:text-primary-600 hover:bg-gray-50 transition duration-300 text-sm gap-4 items-center flex w-full"
                                                                        hx-get="{% url 'horilla_dashboard:move_to_another_dashboard' component.pk %}"
                                                                        hx-target="#modalBox" hx-swap="innerHTML" hx-trigger="click"
                                                                        onclick="openModal()">
                                                                        {% trans "Add to Another Dashboard" %}
                                                                    </a>
                                                                </li>
                                                            {% endif %}

                                                            {% has_perm "horilla_dashboard.delete_dashboard" as can_delete_dashboard %}
                                                            {% if can_delete_dashboard %}
                                                                <li>
                                                                    <a href="#"
                                                                        class="px-4 py-1.5 hover:text-primary-600 hover:bg-gray-50 transition duration-300 text-sm gap-4 items-center flex w-full"
                                                                        hx-post="{% url 'horilla_dashboard:component_delete' component.pk %}"
                                                                        hx-target="#deleteModeBox" hx-swap="innerHTML" hx-trigger="click"
                                                                        onclick="openDeleteModeModal();"
                                                                        hx-vals='{"check_dependencies": "true"}'>
                                                                        {% trans "Delete" %}
                                                                    </a>
                                                                </li>
                                                            {% endif %}
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            {% if component.component_type == 'chart' %}
                                                <div class="chart-container relative w-full" style="height: 344px">
                                                    <div hx-get="{% url 'horilla_dashboard:component_chart' component_id=component.id %}"
                                                        hx-trigger="load" hx-swap="innerHTML"
                                                        class="w-full h-full">
                                                        <div class="text-gray-500 text-sm flex items-center justify-center h-full">
                                                            {% trans " Loading chart..." %}
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if component.reports %}
                                                    <div class="mt-3 flex items-center gap-2 text-xs text-gray-600">
                                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-primary-300 rounded-md">
                                                            <i class="fa-solid fa-file-lines text-black"></i>
                                                            <span class="font-bold">{% trans "Created From report" %}</span>
                                                            <a href="{% url 'horilla_reports:report_detail' component.reports.pk %}"
                                                            class="text-primary-600 hover:text-blue-800 font-bold"
                                                            hx-get="{% url 'horilla_reports:report_detail' component.reports.pk %}"
                                                            hx-target="#mainContent"
                                                            hx-swap="outerHTML"
                                                            hx-select="#mainContent"
                                                            hx-push-url="true">
                                                                {{component.reports.name}}
                                                            </a>
                                                        </span>
                                                    </div>
                                                {% endif %}
                                            {% elif component.component_type == 'table_data' %}
                                                <div>
                                                    {% with ctx=table_contexts|lookup:component.id %}
                                                        {% unpack_context ctx %} {% include "list_view.html" %}
                                                    {% endwith %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% else %}
                <div class="flex flex-col items-center justify-center min-h-[400px] text-center background bg-white">
                    <div class="mb-6">
                        <svg class="w-20 h-20 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">
                        {% trans 'No Components Added'%}
                    </h3>
                    <p class="text-gray-500 mb-6 max-w-md">
                        {% trans "This dashboard doesn't have any components yet. Add charts, tables, KPIs, or targets to visualize your data." %}
                    </p>
                </div>
            {% endif %}


            <script>
                $(document).ready(function () {
                    initializeSelect2();
                    initializeReorderTabs();
                    bindEventHandlers();
                });

                function initializeSelect2() {
                    $("#exportFormat").select2({
                        width: "100%",
                        theme: "default",
                    });

                    $("select").on("select2:select", function (e) {
                        this.dispatchEvent(new Event("change"));
                    });
                }

                function initializeReorderTabs() {
                    switchReorderTab("components");
                }

                function bindEventHandlers() {
                    $("#componentReorderForm").on("submit", handleComponentReorderSubmit);
                    $("#kpiReorderForm").on("submit", handleKpiReorderSubmit);

                    $("#reorderModal").on("click", handleModalOutsideClick);

                    $("#reorderModal .bg-white").on("click", function (e) {
                        e.stopPropagation();
                    });
                }

                function exportChart(chartId, chartName, format) {
                    const $chartDom = $("#" + chartId);

                    if ($chartDom.length === 0) {
                        console.error("Chart DOM element not found for ID:", chartId);
                        alert("Failed to export chart: Chart element not found.");
                        return;
                    }

                    if (
                        typeof EChartsConfig === "undefined" ||
                        typeof echarts === "undefined"
                    ) {
                        console.error("EChartsConfig or echarts not available");
                        alert("Failed to export chart: Required libraries are not available.");
                        return;
                    }

                    const myChart = echarts.getInstanceByDom($chartDom[0]);

                    if (myChart) {
                        EChartsConfig.exportChart(myChart, chartName, format);
                    } else {
                        console.error("Chart instance not found for ID:", chartId);
                        alert("Failed to export chart: Chart instance not found.");
                    }
                }

                function openReorderModal() {
                    $("#reorderModal").removeClass("hidden");
                    $("body").css("overflow", "hidden");
                }

                function closeReorderModal() {
                    $("#reorderModal").addClass("hidden");
                    $("body").css("overflow", "auto");
                }

                function switchReorderTab(tabType) {
                    const $componentsTab = $("#tab-components");
                    const $kpiTab = $("#tab-kpi");
                    const $componentsContent = $("#tab-components-content");
                    const $kpiContent = $("#tab-kpi-content");

                    $componentsContent.addClass("hidden");
                    $kpiContent.addClass("hidden");

                    $componentsTab
                        .removeClass("text-primary-600 border-b-2 border-primary-600")
                        .addClass("text-[#333]");
                    $kpiTab
                        .removeClass("text-primary-600 border-b-2 border-primary-600")
                        .addClass("text-[#333]");

                    if (tabType === "components") {
                        $componentsContent.removeClass("hidden");
                        $componentsTab
                            .removeClass("text-[#333]")
                            .addClass("text-primary-600 border-b-2 border-primary-600");
                        $componentsTab.attr("aria-selected", "true");
                        $kpiTab.attr("aria-selected", "false");
                    } else {
                        $kpiContent.removeClass("hidden");
                        $kpiTab
                            .removeClass("text-[#333]")
                            .addClass("text-primary-600 border-b-2 border-primary-600");
                        $kpiTab.attr("aria-selected", "true");
                        $componentsTab.attr("aria-selected", "false");
                    }
                }

                function moveComponent(componentId, direction, tabType) {
                    const listId = tabType === "kpi" ? "kpiOrderList" : "componentOrderList";
                    const $list = $("#" + listId);
                    const $currentItem = $list.find(`li[data-component-id="${componentId}"]`);

                    if ($currentItem.length === 0) return;

                    if (direction === "up") {
                        const $prevItem = $currentItem.prev();
                        if ($prevItem.length) {
                            $currentItem.insertBefore($prevItem);
                        }
                    } else if (direction === "down") {
                        const $nextItem = $currentItem.next();
                        if ($nextItem.length) {
                            $currentItem.insertAfter($nextItem);
                        }
                    }

                    updateComponentOrder(tabType);
                }

                function updateComponentOrder(tabType) {
                    const listId = tabType === "kpi" ? "kpiOrderList" : "componentOrderList";
                    const inputsContainerId =
                        tabType === "kpi" ? "kpiOrderInputs" : "componentOrderInputs";

                    const $list = $("#" + listId);
                    const $items = $list.find("li[data-component-id]");
                    const $inputsContainer = $("#" + inputsContainerId);

                    $inputsContainer.empty();

                    $items.each(function (index) {
                        const componentId = $(this).data("component-id");
                        const $input = $("<input>", {
                            type: "hidden",
                            name: "component_order",
                            value: componentId,
                        });
                        $inputsContainer.append($input);
                    });
                }

                function handleComponentReorderSubmit(e) {
                    e.preventDefault();
                    submitReorderForm(this, "components");
                }

                function handleKpiReorderSubmit(e) {
                    e.preventDefault();
                    submitReorderForm(this, "kpi");
                }

                function submitReorderForm(form, type) {
                    const $form = $(form);
                    const formData = new FormData(form);
                    const csrfToken = $("[name=csrfmiddlewaretoken]").val();

                    $.ajax({
                        url: form.action,
                        method: "POST",
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: {
                            "X-CSRFToken": csrfToken,
                        },
                        success: function (data) {
                            if (data.success) {
                                closeReorderModal();
                                window.location.reload();
                            } else {
                                alert("Error: " + (data.error || `Failed to reorder ${type}`));
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error("Error:", error);
                            alert(`An error occurred while reordering ${type}`);
                        },
                    });
                }

                function handleModalOutsideClick(e) {
                    if (e.target === this) {
                        closeReorderModal();
                    }
                }

                window.exportChart = exportChart;
                window.openReorderModal = openReorderModal;
                window.closeReorderModal = closeReorderModal;
                window.switchReorderTab = switchReorderTab;
                window.moveComponent = moveComponent;
            </script>
        </div>
    </div>
</div>

<div id="reorderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[999] flex items-center justify-center">
    <div
        class="bg-white w-full max-w-md rounded-lg shadow-lg p-0 transition-all duration-300 md:min-w-[650px] opacity-100 scale-100">
        <div class="relative p-4 w-full max-w-2xl max-h-full">
            <div class="relative bg-white rounded-lg shadow-sm">
                <!-- Header -->
                <div class="p-5 pt-3">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-md font-semibold">
                                {% trans 'Reorder Components'%}
                            </h2>
                        </div>
                        <button type="button" onclick="closeReorderModal()"
                            class="text-gray-500 hover:text-red-500 text-xl">
                            <img src="{% static 'assets/icons/close.svg' %}" alt="icon" />
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="mb-4 border-b border-[#dddddd]">
                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="reorder-tabs"
                        data-tabs-toggle="#reorder-tabs-content" data-tabs-active-classes="text-primary-600 border-b-2"
                        data-tabs-inactive-classes="text-[#333] hover:text-primary-600 hover:border-gray-300"
                        role="tablist">
                        <li class="me-2" role="presentation">
                            <button
                                class="inline-block px-5 py-3 text-sm border-b-2 rounded-t-lg transition duration-300"
                                id="tab-components" data-tabs-target="#tab-components-content" type="button" role="tab"
                                aria-controls="tab-components-content" aria-selected="true"
                                onclick="switchReorderTab('components')">
                                {% trans 'Reorder Components' %}
                            </button>
                        </li>
                        <li class="me-2" role="presentation">
                            <button
                                class="inline-block px-5 py-3 text-sm border-b-2 rounded-t-lg transition duration-300"
                                id="tab-kpi" data-tabs-target="#tab-kpi-content" type="button" role="tab"
                                aria-controls="tab-kpi-content" aria-selected="false" onclick="switchReorderTab('kpi')">
                                {% trans 'Reorder KPIs' %}
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Tab Content -->
                <div id="reorder-tabs-content" class="overflow-hidden">
                    <!-- Components Tab -->
                    <div id="tab-components-content" role="tabpanel" aria-labelledby="tab-components">
                        <form id="componentReorderForm" method="post"
                            action="{% url 'horilla_dashboard:reorder_components' dashboard_id=current_obj.pk %}">
                            {% csrf_token %}
                            <div class="p-5 pt-3">
                                <div class="grid grid-cols-1 gap-4">
                                    <div class="mt-4">
                                        <ul class="flex gap-2 flex-col border-[1px] border-[solid] border-[#e5e5e5] rounded-[10px] h-[400px] overflow-hidden overflow-y-auto p-4"
                                            id="componentOrderList">
                                            {% for component in components %}
                                                {% if component.component_type != 'kpi' %}
                                                    <li data-component-id="{{ component.id }}"
                                                        data-sequence="{{ component.sequence }}">
                                                        <div class="flex justify-between items-center relative component-item">
                                                            <div
                                                                class="ps-4 pr-16 bg-primary-100 px-[10px] py-[8px] w-full flex text-[#333] border-[1px] border-[solid] border-[#dddddd] rounded-[5px] text-[.8rem]">
                                                                <div class="flex items-center gap-3">
                                                                    {% if component.component_type == 'chart' %}
                                                                        <i class="fa-solid fa-chart-bar text-blue-500"></i>
                                                                    {% elif component.component_type == 'table_data' %}
                                                                        <i class="fa-solid fa-table text-green-500"></i>
                                                                    {% endif %}
                                                                    <div>
                                                                        <div class="font-medium">
                                                                            {{ component.name }}
                                                                        </div>
                                                                        <div class="text-xs text-gray-500">
                                                                            {% if component.component_type == 'chart' %}
                                                                                {% trans 'Chart' %} - {{ component.get_chart_type_display }}
                                                                            {% elif component.component_type == 'table_data' %}
                                                                                {% trans 'Table Data' %} - {{ component.module|title }}
                                                                            {% endif %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="flex absolute right-0 h-full">
                                                                <button type="button"
                                                                    onclick="moveComponent({{ component.id }}, 'up', 'components')"
                                                                    class="border-[1px] border-r-[0px] border-[solid] w-8 text-[#e54f38] text-xs transition duration-300 hover:bg-gray-100">
                                                                    <i class="fa-solid fa-angle-up"></i>
                                                                </button>
                                                                <button type="button"
                                                                    onclick="moveComponent({{ component.id }}, 'down', 'components')"
                                                                    class="border-[1px] border-[solid] w-8 text-[#e54f38] text-xs transition duration-300 rounded-r-[5px] hover:bg-gray-100">
                                                                    <i class="fa-solid fa-angle-down"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </li>
                                                {% endif %}
                                            {% empty %}
                                                <li class="text-center text-gray-500 py-8">
                                                    {% trans 'No components to reorder' %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="dashboard_id" value="{{ current_obj.id }}" />
                            <input type="hidden" name="reorder_type" value="components" />
                            <div id="componentOrderInputs">
                                {% for component in components %}
                                    {% if component.component_type != 'kpi' %}
                                        <input type="hidden" name="component_order" value="{{ component.id }}" />
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="flex justify-end p-5">
                                <button type="submit"
                                    class="text-sm px-4 py-2 bg-primary-600 rounded-md hover:bg-primary-800 transition duration-300 text-[white]">
                                    {% trans 'Save Component Order' %}
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- KPI Tab -->
                    <div id="tab-kpi-content" role="tabpanel" aria-labelledby="tab-kpi" class="hidden">
                        <form id="kpiReorderForm" method="post"
                            action="{% url 'horilla_dashboard:reorder_components' dashboard_id=current_obj.pk %}">
                            {% csrf_token %}
                            <div class="p-5 pt-3">
                                <div class="grid grid-cols-1 gap-4">
                                    <div class="mt-4">
                                        <ul class="flex gap-2 flex-col border-[1px] border-[solid] border-[#e5e5e5] rounded-[10px] h-[400px] overflow-hidden overflow-y-auto p-4"
                                            id="kpiOrderList">
                                            {% for component in components %}
                                                {% if component.component_type == 'kpi' %}
                                                <li data-component-id="{{ component.id }}"
                                                    data-sequence="{{ component.sequence }}">
                                                    <div class="flex justify-between items-center relative component-item">
                                                        <div
                                                            class="ps-4 pr-16 bg-primary-100 px-[10px] py-[8px] w-full flex text-[#333] border-[1px] border-[solid] border-[#dddddd] rounded-[5px] text-[.8rem]">
                                                            <div class="flex items-center gap-3">
                                                                <i class="fa-solid fa-chart-line text-yellow-600"></i>
                                                                <div>
                                                                    <div class="font-medium">
                                                                        {{ component.name }}
                                                                    </div>
                                                                    <div class="text-xs text-gray-500">
                                                                        {% trans 'KPI' %} - {{ component.get_metric_type_display|default:component.metric_type|title }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="flex absolute right-0 h-full">
                                                            <button type="button"
                                                                onclick="moveComponent({{ component.id }}, 'up', 'kpi')"
                                                                class="border-[1px] border-r-[0px] border-[solid] w-8 text-[#e54f38] text-xs transition duration-300 hover:bg-gray-100">
                                                                <i class="fa-solid fa-angle-up"></i>
                                                            </button>
                                                            <button type="button"
                                                                onclick="moveComponent({{ component.id }}, 'down', 'kpi')"
                                                                class="border-[1px] border-[solid] w-8 text-[#e54f38] text-xs transition duration-300 rounded-r-[5px] hover:bg-gray-100">
                                                                <i class="fa-solid fa-angle-down"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </li>
                                                {% endif %}
                                            {% empty %}
                                                <li class="text-center text-gray-500 py-8">
                                                    {% trans 'No KPI components to reorder' %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="dashboard_id" value="{{ current_obj.id }}" />
                            <input type="hidden" name="reorder_type" value="kpi" />
                            <div id="kpiOrderInputs">
                                {% for component in components %}
                                    {% if component.component_type == 'kpi' %}
                                        <input type="hidden" name="component_order" value="{{ component.id }}" />
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="flex justify-end p-5">
                                <button type="submit"
                                    class="text-sm px-4 py-2 bg-primary-600 rounded-md hover:bg-primary-800 transition duration-300 text-[white]">
                                    {% trans 'Save KPI Order' %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
